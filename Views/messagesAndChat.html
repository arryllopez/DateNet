<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Messenger Inbox</title>
    <link rel="stylesheet" href="messagesAndChat.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    
    <!--NAV  BAR-->
    <header>
        <div class="container">
            <div class="header-content">
                <nav>
                    <ul>
                        <li><a href="#"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg> Messages</a></li>
                        <li><a href="match.html"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg> Matches</a></li>
                        <li><a href="generalChat.html"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path></svg> Global Chat</a></li>
                        <li><a href="profile.html"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg> Profile</a></li>
                        <li><a href="#" onclick="logout();"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg> Logout</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>






    <div class="inbox-container">
        <div class="inbox-sidebar">
            <div class="inbox-header">
                <h1 id="nameOfUser"></h1> 
            </div>

            <div class="messages-section">
                <div class="messages-header">
                    <h2>Messages</h2>
                </div>

                <div id="message-list" class="message-list">
                    <!-- Messages will be dynamically added here -->
                </div>
            </div>
        </div>

        <div id="empty-state" class="empty-state">
            <div class="empty-content">
                <div class="messenger-icon">
                    <img src="Images/social-network.png" alt="Messenger Icon">
                </div>
                <h2>Find a Match Now!</h2>
                <a href="match.html"><button class="send-message-btn">Find Match</button></a>
            </div>
        </div>

        <div id="direct-message" class="direct-message" style="display: none;">
            <div class="direct-message-header">
                <h2>Chat with <span id="chat-user"></span></h2>
            </div>
            <div class="direct-message-content">
                <!-- Messages will be dynamically added here -->
            </div>
            <div class="direct-message-input">
                <input type="text" placeholder="Type a message...">
                <button id="send-button">Send</button>
            </div>
        </div>
    </div>

    <script>
        function logout() {
            localStorage.removeItem('token');
            window.location.href = 'login.html';
        }

        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Fetch the profile data
                const response = await fetch('http://localhost:3000/api/auth/profile', {
                    headers: {
                        Authorization: `Bearer ${localStorage.getItem('token')}`,
                    },
                });

                // Parse JSON response
                const data = await response.json();

                if (response.ok) {
                    // Update the DOM with user data
                    document.getElementById('nameOfUser').innerHTML = `${data.firstName} ${data.lastName}`;
                } else {
                    // Handle error from API
                    alert(data.message || 'Error fetching profile data.');
                }
            } catch (error) {
                // Log errors in the console
                console.error('Error fetching profile data:', error);
            }

            const messageList = document.getElementById('message-list');
            const emptyState = document.getElementById('empty-state');
            const directMessage = document.getElementById('direct-message');
            const lastMessage = JSON.parse(localStorage.getItem('lastMessage'));

            if (lastMessage) {
                const messageItem = document.createElement('div');
                messageItem.className = 'message-item';
                messageItem.innerHTML = `
                    <div class="message-content">
                        <div class="message-header">
                            <h3>${lastMessage.user}</h3>
                            <span class="timestamp">${new Date(lastMessage.timestamp).toLocaleTimeString()}</span>
                        </div>
                        <p>${lastMessage.message}</p>
                    </div>
                `;
                messageList.appendChild(messageItem);

                // Add click event listener to the message item
                messageItem.addEventListener('click', () => {
                    emptyState.style.display = 'none';
                    directMessage.style.display = 'flex';
                    document.getElementById('chat-user').textContent = lastMessage.user;
                    // Clear previous messages
                    document.querySelector('.direct-message-content').innerHTML = '';
                    // Add the last message
                    const messageElement = document.createElement('p');
                    messageElement.textContent = lastMessage.message;
                    document.querySelector('.direct-message-content').appendChild(messageElement);
                });
            }
        });
    </script>
</body>
</html>

